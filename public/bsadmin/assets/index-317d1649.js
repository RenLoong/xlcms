import{d as B,r as f,h as Q,a as k,A as G,w as s,k as b,l as o,y,u as d,B as H,$ as n,q as r,D as z,ae as J,v as K,s as W,az as X,a2 as A,E as Y,z as M,G as Z,e as ee,o as te,c as $,a1 as oe,aj as le,t as T,ak as ae,al as se,P as ne}from"./index-3b328f2a.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                        *//* empty css                 *//* empty css                  */import{_ as re}from"./xlcms-el-option.vue_vue_type_script_setup_true_lang-ce304949.js";/* empty css                   */const de={class:"dialog-footer flex"},ce=b("div",{class:"flex-1"},null,-1),ie=B({__name:"create-role",emits:["success"],setup(I,{expose:R,emit:v}){const g=f(),h=f(),_=f(!1),C=f([]),S=f([]),V=Q({name:[{required:!0,message:"请输入角色名称",trigger:"blur"}]}),t=f({id:void 0,pid:void 0,name:"",state:1,rule:[]}),a=(e,l)=>e.son_auth?"is-penultimate":"",c=()=>{n.get("auth/index",{params:{action:"tree"}}).then(e=>{e.code===n.ResponseCode.SUCCESS&&(S.value=e.data)}).catch(e=>{r.error(e.message)})},i=()=>{n.get("role/index").then(e=>{e.code===n.ResponseCode.SUCCESS&&(C.value=e.data)}).catch(e=>{r.error(e.message)})},u=()=>{let e=[];t.value.rule.map(l=>{e.push({id:l})}),h.value.setCheckedNodes(e)},w=e=>{x(),t.value.id=void 0,t.value.rule=[],u(),e()},U=()=>{let e=[];h.value.getCheckedNodes(!1,!0).map(l=>{e.push(l.id)}),t.value.rule=e,g.value.validate((l,N)=>{if(l){let E="role/index/Add";t.value.id&&(E="role/index/Edit"),n.post(E,t.value).then(m=>{m.code===n.ResponseCode.SUCCESS?(r.success(m.message),w(()=>{_.value=!1}),v("success")):r.info(m.message)}).catch(m=>{r.error(m.message)})}else r.warning("请完善表单")})},x=()=>{g.value&&g.value.resetFields()};return R({open:e=>{i(),c(),_.value=!0,e&&z(()=>{t.value=Object.assign({},e)})}}),(e,l)=>{const N=re,E=J,m=K,O=W,P=X,j=A,q=Y,D=M,L=Z;return k(),G(L,{modelValue:d(_),"onUpdate:modelValue":l[6]||(l[6]=p=>H(_)?_.value=p:null),title:d(t).id?"编辑角色":"创建角色",width:"50%","before-close":w,onOpened:u,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"form-dialog"},{footer:s(()=>[b("span",de,[o(D,{onClick:l[3]||(l[3]=p=>{w(()=>{_.value=!1})})},{default:s(()=>[y("取消")]),_:1}),ce,o(D,{onClick:l[4]||(l[4]=p=>x())},{default:s(()=>[y("重置")]),_:1}),o(D,{type:"primary",onClick:l[5]||(l[5]=p=>U())},{default:s(()=>[y("提交")]),_:1})])]),default:s(()=>[o(q,{"label-position":"right","label-width":"200px",size:"large",ref_key:"roleForm",ref:g,class:"w-80",model:d(t),rules:d(V)},{default:s(()=>[o(m,{label:"上级角色"},{default:s(()=>[o(E,{modelValue:d(t).pid,"onUpdate:modelValue":l[0]||(l[0]=p=>d(t).pid=p),placeholder:"默认为部门",clearable:"",class:"flex-1"},{default:s(()=>[o(N,{list:d(C),showicon:!1},null,8,["list"])]),_:1},8,["modelValue"])]),_:1}),o(m,{label:"名称",prop:"name"},{default:s(()=>[o(O,{modelValue:d(t).name,"onUpdate:modelValue":l[1]||(l[1]=p=>d(t).name=p),placeholder:"角色名称"},null,8,["modelValue"])]),_:1}),o(m,{label:"规则",prop:"rule"},{default:s(()=>[o(P,{ref_key:"authDataEl",ref:h,data:d(S),"node-key":"id",props:{label:"title",class:a},"default-expand-all":"","show-checkbox":"",class:"w-100"},null,8,["data","props"])]),_:1}),o(m,{label:"状态",prop:"state"},{default:s(()=>[o(j,{modelValue:d(t).state,"onUpdate:modelValue":l[2]||(l[2]=p=>d(t).state=p),"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}});const ue={class:"bg-white rounded-4 p-4 flex-1 overflow-hidden flex flex-column"},me={class:"flex pb-4"},pe=b("div",{class:"flex-1"},null,-1),_e={key:0},fe={key:1},he=B({name:"/role"}),Re=B({...he,setup(I){const{setMenu:R}=ee(),v=f([]),g=(t,a,c)=>{n.get("role/index/Query",{params:{id:t.id}}).then(i=>{i.code===n.ResponseCode.SUCCESS&&c(i.data)}).catch(i=>{r.error(i.message)})},h=()=>{n.get("role/index/Query").then(t=>{v.value=[],t.code===n.ResponseCode.SUCCESS&&(v.value=t.data)}).catch(t=>{r.error(t.message)})},_=()=>{const t=ae.service();n.get("role/index/Cache").then(a=>{t.close(),a&&(a.code===n.ResponseCode.SUCCESS?(R(a.data),r.success(a.message)):r.info(a.message))}).catch(a=>{t.close(),r.error(a.message)})},C=f(),S=t=>{const a=t.row.state?0:1;n.post("role/index/SetState",{id:t.row.id}).then(c=>{if(c.code===n.ResponseCode.SUCCESS)r.success(c.message);else throw new Error(c.message)}).catch(c=>{r.error(c.message),z(()=>{t.row.state=a})})},V=t=>{n.post("role/index/Delete",{id:t.row.id}).then(a=>{a&&(a.code===n.ResponseCode.SUCCESS?(r.success(a.message),v.value=[],h()):r.info(a.message))}).catch(a=>{r.error(a.message)})};return te(()=>{h()}),(t,a)=>{const c=M,i=oe,u=se,w=A,U=ne,x=le,F=ie;return k(),$("div",ue,[b("div",me,[o(i,{effect:"dark",content:"刷新缓存",placement:"bottom-end"},{default:s(()=>[o(c,{type:"warning",icon:"Refresh",onClick:_})]),_:1}),o(i,{effect:"dark",content:"创建角色",placement:"bottom-end"},{default:s(()=>[o(c,{type:"primary",icon:"Plus",onClick:a[0]||(a[0]=e=>d(C).open())},{default:s(()=>[y("创建")]),_:1})]),_:1}),pe]),o(x,{data:d(v),style:{width:"100%",height:"100%"},"row-key":"id",border:"",lazy:"",load:g,"tree-props":{children:"children",hasChildren:"hasChildren"}},{default:s(()=>[o(u,{prop:"name",label:"名称",width:"200"}),o(u,{label:"权限"},{default:s(e=>[e.row.rule.length>=e.row.auth_sum?(k(),$("div",_e," 拥有全部权限 ")):(k(),$("div",fe," 拥有"+T(e.row.rule.length)+"项权限 ",1))]),_:1}),o(u,{label:"成员"},{default:s(e=>[b("div",null," 共有"+T(e.row.admin_num)+"位成员 ",1)]),_:1}),o(u,{label:"状态",width:"80"},{default:s(e=>[o(w,{modelValue:e.row.state,"onUpdate:modelValue":l=>e.row.state=l,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},onChange:l=>S(e)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),o(u,{prop:"update_time",label:"最后一次修改时间",width:"200"}),o(u,{prop:"create_time",label:"创建时间",width:"200"}),o(u,{fixed:"right",label:"#",width:"160"},{default:s(e=>[o(i,{effect:"dark",content:"编辑",placement:"left"},{default:s(()=>[o(c,{type:"primary",icon:"Edit",size:"small",onClick:l=>d(C).open(e.row)},null,8,["onClick"])]),_:2},1024),o(U,{icon:"Delete","icon-color":"var(--el-color-danger)",title:"确定继续删除该数据及子数据吗？",width:"200px","confirm-button-text":"继续删除","confirm-button-type":"danger",onConfirm:l=>V(e)},{reference:s(()=>[o(c,{type:"danger",icon:"Delete",size:"small"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),o(F,{ref_key:"createRoleRef",ref:C,onSuccess:h},null,512)])}}});export{Re as default};
