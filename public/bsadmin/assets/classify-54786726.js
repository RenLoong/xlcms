import{d as D,r as y,h as O,a as R,A as B,w as s,k as b,l as e,y as x,u as i,B as P,$ as c,q as d,D as F,ae as q,v as M,s as Q,ag as z,a2 as N,E as G,z as T,G as K,o as H,c as J,a1 as W,aj as X,K as Y,ak as Z,al as ee,P as te,am as le}from"./index-3b328f2a.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                        *//* empty css                 *//* empty css                  */import{_ as oe}from"./xlcms-el-option.vue_vue_type_script_setup_true_lang-ce304949.js";/* empty css                        *//* empty css                   */const se=b("div",{class:"text-grey h10 line-height-2 pt-2"},[b("div",null,"可通过别名获取该分类下的文章")],-1),ae={class:"dialog-footer flex"},ne=b("div",{class:"flex-1"},null,-1),ie=D({__name:"create-article-classify",emits:["success"],setup(j,{expose:v,emit:k}){const h=y(),g=y(!1),V=y([]),S=O({title:[{required:!0,message:"请输入分类名称",trigger:"blur"}]}),n=y({title:"",pid:void 0,alias:"",sort:99,state:1}),A=()=>{c.get("article/classify").then(r=>{r.code===c.ResponseCode.SUCCESS&&(V.value=r.data)}).catch(r=>{d.error(r.message)})},U=()=>{},l=r=>{a(),n.value.id=void 0,r()},t=()=>{h.value.validate((r,o)=>{if(r){let w="article/classify/Add";n.value.id&&(w="article/classify/Edit"),c.post(w,n.value).then(_=>{_.code===c.ResponseCode.SUCCESS?(d.success(_.message),l(()=>{g.value=!1}),k("success")):d.info(_.message)}).catch(_=>{d.error(_.message)})}else d.warning("请完善表单")})},a=()=>{h.value&&h.value.resetFields()};return v({open:r=>{A(),g.value=!0,r&&F(()=>{n.value=Object.assign(n.value,r)})}}),(r,o)=>{const w=oe,_=q,C=M,E=Q,u=z,p=N,I=G,$=T,L=K;return R(),B(L,{modelValue:i(g),"onUpdate:modelValue":o[8]||(o[8]=m=>P(g)?g.value=m:null),title:i(n).id?"编辑分类":"创建分类",width:"50%","before-close":l,onOpened:U,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"form-dialog"},{footer:s(()=>[b("span",ae,[e($,{onClick:o[5]||(o[5]=m=>{l(()=>{g.value=!1})})},{default:s(()=>[x("取消")]),_:1}),ne,e($,{onClick:o[6]||(o[6]=m=>a())},{default:s(()=>[x("重置")]),_:1}),e($,{type:"primary",onClick:o[7]||(o[7]=m=>t())},{default:s(()=>[x("提交")]),_:1})])]),default:s(()=>[e(I,{"label-position":"right","label-width":"200px",size:"large",ref_key:"roleForm",ref:h,class:"w-80",model:i(n),rules:i(S)},{default:s(()=>[e(C,{label:"上级分类"},{default:s(()=>[e(_,{modelValue:i(n).pid,"onUpdate:modelValue":o[0]||(o[0]=m=>i(n).pid=m),placeholder:"默认为顶级分类",clearable:"",class:"flex-1"},{default:s(()=>[e(w,{list:i(V),showicon:!1},null,8,["list"])]),_:1},8,["modelValue"])]),_:1}),e(C,{label:"名称",prop:"title"},{default:s(()=>[e(E,{modelValue:i(n).title,"onUpdate:modelValue":o[1]||(o[1]=m=>i(n).title=m),placeholder:"分类名称"},null,8,["modelValue"])]),_:1}),e(C,{label:"别名",prop:"alias"},{default:s(()=>[e(E,{modelValue:i(n).alias,"onUpdate:modelValue":o[2]||(o[2]=m=>i(n).alias=m),placeholder:"分类别名"},null,8,["modelValue"]),se]),_:1}),e(C,{label:"排序",prop:"sort"},{default:s(()=>[e(u,{modelValue:i(n).sort,"onUpdate:modelValue":o[3]||(o[3]=m=>i(n).sort=m),min:0,max:99,placeholder:"排序正序",controls:!1},null,8,["modelValue"])]),_:1}),e(C,{label:"状态",prop:"state"},{default:s(()=>[e(p,{modelValue:i(n).state,"onUpdate:modelValue":o[4]||(o[4]=m=>i(n).state=m),"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),re={class:"bg-white rounded-4 p-4 flex-1 overflow-hidden flex flex-column"},ce={class:"flex pb-4"},de=b("div",{class:"flex-1"},null,-1),ue=D({name:"/article/classify"}),Se=D({...ue,setup(j){const v=y([]),k=(l,t,a)=>{c.get("article/classify/Query",{params:{id:l.id}}).then(f=>{f.code===c.ResponseCode.SUCCESS&&a(f.data)}).catch(f=>{d.error(f.message)})},h=()=>{c.get("article/classify/Query").then(l=>{v.value=[],l.code===c.ResponseCode.SUCCESS&&(v.value=l.data)}).catch(l=>{d.error(l.message)})},g=()=>{const l=Z.service();c.get("article/classify/Cache").then(t=>{l.close(),t&&(t.code===c.ResponseCode.SUCCESS?d.success(t.message):d.info(t.message))}).catch(t=>{l.close(),d.error(t.message)})},V=l=>{c.post("article/classify/Delete",{id:l.row.id}).then(t=>{t&&(t.code===c.ResponseCode.SUCCESS?(d.success(t.message),v.value=[],h()):d.info(t.message))}).catch(t=>{d.error(t.message)})},S=y(),n=l=>{const t=l.row.state?0:1;c.post("article/classify/SetState",{id:l.row.id}).then(a=>{if(a.code===c.ResponseCode.SUCCESS)d.success(a.message);else throw new Error(a.message)}).catch(a=>{d.error(a.message),F(()=>{l.row.state=t})})},U=le((l,t)=>{c.post("article/classify/SetSort",{id:t.row.id,sort:l}).then(a=>{if(a.code!==c.ResponseCode.SUCCESS)throw new Error(a.message)}).catch(a=>{d.error(a.message)})},300);return H(()=>{h()}),(l,t)=>{const a=T,f=W,r=ee,o=N,w=z,_=te,C=X,E=ie;return R(),J("div",re,[b("div",ce,[e(f,{effect:"dark",content:"刷新缓存",placement:"bottom-end"},{default:s(()=>[e(a,{type:"warning",icon:"Refresh",onClick:g})]),_:1}),e(f,{effect:"dark",content:"创建分类",placement:"bottom-end"},{default:s(()=>[e(a,{type:"primary",icon:"Plus",onClick:t[0]||(t[0]=u=>i(S).open())},{default:s(()=>[x("创建")]),_:1})]),_:1}),de]),e(C,{data:i(v),style:{width:"100%",height:"100%"},"row-key":"id",border:"",lazy:"",load:k,"tree-props":{children:"children",hasChildren:"hasChildren"}},{default:s(()=>[e(r,{prop:"title",label:"名称","min-width":"200"}),e(r,{prop:"alias",label:"名称",width:"200"}),e(r,{label:"状态",width:"80"},{default:s(u=>[e(o,{modelValue:u.row.state,"onUpdate:modelValue":p=>u.row.state=p,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},onChange:p=>n(u)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(r,{label:"排序",width:"146"},{default:s(u=>[e(w,{modelValue:u.row.sort,"onUpdate:modelValue":p=>u.row.sort=p,min:0,max:99,step:1,"step-strictly":"",size:"small",onChange:p=>i(U)(p,u)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(r,{fixed:"right",label:"#",width:"160"},{default:s(u=>[e(f,{effect:"dark",content:"编辑",placement:"left"},{default:s(()=>[e(a,{type:"primary",icon:"Edit",size:"small",onClick:p=>i(S).open(u.row)},null,8,["onClick"])]),_:2},1024),!u.row.hasChildren&&u.row.articleCount<=0?(R(),B(_,{key:0,icon:"Delete","icon-color":"var(--el-color-danger)",title:"确定继续删除该数据吗？",width:"200px","confirm-button-text":"继续删除","confirm-button-type":"danger",onConfirm:p=>V(u)},{reference:s(()=>[e(a,{type:"danger",icon:"Delete",size:"small"})]),_:2},1032,["onConfirm"])):Y("",!0)]),_:1})]),_:1},8,["data"]),e(E,{ref_key:"createArticleClassifyRef",ref:S,onSuccess:h},null,512)])}}});export{Se as default};
