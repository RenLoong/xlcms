import{d as J,r as C,as as K,h as re,a as h,A as y,w as l,k as _,l as e,y as D,u as a,B as X,c as x,I as B,J as j,at as U,t as $,au as ue,av as ce,S as O,K as z,D as G,$ as d,q as m,ae as de,v as me,s as he,aw as pe,ax as _e,F as Z,z as ee,ay as fe,ag as te,a2 as le,E as ve,G as ge,e as we,o as Ce,a1 as xe,aj as be,ak as Ve,al as Se,P as ye,am as ke}from"./index-3b328f2a.js";/* empty css                   *//* empty css                     *//* empty css               *//* empty css                        *//* empty css                 *//* empty css                   *//* empty css                  *//* empty css                          *//* empty css                        *//* empty css                  */import{_ as Ee}from"./xlcms-el-option.vue_vue_type_script_setup_true_lang-ce304949.js";import{H as Y,p as Ue}from"./php-b26c5332.js";const $e=_("div",{class:"text-grey"},"WEB端用作路由，服务端用作API，无需‘/’开头",-1),Ae={class:"flex w-100"},Ie=_("div",{class:"mx-1 text-grey"},"/",-1),Re=_("div",{class:"text-grey"},"作为服务端API验权使用",-1),De={class:"w-100 flex"},ze=_("div",{class:"text-grey ml-3"},"子权限建议放在最后一级",-1),Be={class:"w-100"},Fe={class:"hljs w-100 p-3 line-height-1"},Pe=["innerHTML"],Le={class:"flex flex-wrap overflow-y-auto",style:{height:"400px"}},Te={class:"dialog-footer flex"},je=_("div",{class:"flex-1"},null,-1),Me=J({__name:"create-auth",emits:["success"],setup(oe,{expose:M,emit:A}){Y.registerLanguage("php",Ue);const I=C(),v=C(!1),k=C(!1),R=C(!1),V=C(""),F=C([]),P=C([]);for(const r in K)Object.hasOwnProperty.call(K,r)&&F.value.push(r);const N=()=>{d.get("auth/index").then(r=>{r&&r.code===d.ResponseCode.SUCCESS&&(P.value=r.data)}).catch(r=>{m.error(r.message)})},H=re({title:[{required:!0,message:"请输入名称",trigger:"blur"}],url:[{required:!0,message:"请输入规则",trigger:"blur"}]}),o=C({id:null,pid:null,title:"",icon:"",controller:"",action:"",url:"",is_show:0,state:1,sort:99,son_auth:[]}),q=r=>{N(),v.value=!0,r&&G(()=>{o.value=Object.assign({},r),k.value=o.value.son_auth.length===U.length,R.value=o.value.son_auth.length>0&&o.value.son_auth.length<U.length,E()})},i=r=>{u(),o.value.id=null,r()},c=()=>{I.value.validate((r,t)=>{if(r){let S="auth/index/Add";o.value.id&&(S="auth/index/Edit"),d.post(S,o.value).then(b=>{b.code===d.ResponseCode.SUCCESS?(m.success(b.message),i(()=>{v.value=!1}),A("success")):m.info(b.message)}).catch(b=>{m.error(b.message)})}else m.warning("请完善表单")})},u=()=>{I.value&&I.value.resetFields()},g=r=>{let t=[];r&&U.forEach(S=>{t.push(S.action)}),o.value.son_auth=t,R.value=!1,E()},w=r=>{const t=r.length;k.value=t===U.length,R.value=t>0&&t<U.length,E()},E=()=>{if(o.value.controller&&o.value.action){let r="";r+=`    public function ${o.value.action}(){}
`,o.value.son_auth.forEach(t=>{r+=`    public function ${o.value.action}${t}(){}
`}),V.value=Y.highlight(`<?php 
/**
* 服务端需要实现以下类与方法
*/
class ${o.value.controller} 
{
${r}}`,{language:"php"}).value}else V.value=""};return M({open:q}),(r,t)=>{const S=Ee,b=de,f=me,s=he,p=pe,L=_e,Q=Z,T=ee,ae=fe,se=te,W=le,ne=ve,ie=ge;return h(),y(ie,{modelValue:a(v),"onUpdate:modelValue":t[13]||(t[13]=n=>X(v)?v.value=n:null),title:a(o).id?"编辑规则":"创建规则",width:"50%","before-close":i,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"form-dialog"},{footer:l(()=>[_("span",Te,[e(T,{onClick:t[10]||(t[10]=n=>{i(()=>{v.value=!1})})},{default:l(()=>[D("取消")]),_:1}),je,e(T,{onClick:t[11]||(t[11]=n=>u())},{default:l(()=>[D("重置")]),_:1}),e(T,{type:"primary",onClick:t[12]||(t[12]=n=>c())},{default:l(()=>[D("提交")]),_:1})])]),default:l(()=>[e(ne,{"label-position":"right","label-width":"200px",size:"large",ref_key:"authForm",ref:I,class:"w-80",model:a(o),rules:a(H)},{default:l(()=>[e(f,{label:"上级菜单",prop:"pid"},{default:l(()=>[e(b,{modelValue:a(o).pid,"onUpdate:modelValue":t[0]||(t[0]=n=>a(o).pid=n),placeholder:"默认为顶级菜单",clearable:"",class:"flex-1"},{default:l(()=>[e(S,{list:a(P),showicon:!1},null,8,["list"])]),_:1},8,["modelValue"])]),_:1}),e(f,{label:"名称",prop:"title"},{default:l(()=>[e(s,{modelValue:a(o).title,"onUpdate:modelValue":t[1]||(t[1]=n=>a(o).title=n),placeholder:"权限菜单名称"},null,8,["modelValue"])]),_:1}),e(f,{label:"规则",prop:"url"},{default:l(()=>[e(s,{modelValue:a(o).url,"onUpdate:modelValue":t[2]||(t[2]=n=>a(o).url=n),placeholder:"WEB端用作路由，服务端用作API，无需‘/’开头"},null,8,["modelValue"]),$e]),_:1}),e(f,{label:"控制器/操作"},{default:l(()=>[_("div",Ae,[e(f,{prop:"controller"},{default:l(()=>[e(s,{modelValue:a(o).controller,"onUpdate:modelValue":t[3]||(t[3]=n=>a(o).controller=n),placeholder:"控制器类名",onInput:E},null,8,["modelValue"])]),_:1}),Ie,e(f,{prop:"action"},{default:l(()=>[e(s,{modelValue:a(o).action,"onUpdate:modelValue":t[4]||(t[4]=n=>a(o).action=n),placeholder:"操作名",onInput:E},null,8,["modelValue"])]),_:1})]),Re]),_:1}),e(f,{label:"子权限",prop:"son_auth"},{default:l(()=>[_("div",De,[e(p,{modelValue:a(k),"onUpdate:modelValue":t[5]||(t[5]=n=>X(k)?k.value=n:null),indeterminate:a(R),onChange:g},{default:l(()=>[D("全选")]),_:1},8,["modelValue","indeterminate"]),ze]),_("div",Be,[e(L,{modelValue:a(o).son_auth,"onUpdate:modelValue":t[6]||(t[6]=n=>a(o).son_auth=n),onChange:w},{default:l(()=>[(h(!0),x(B,null,j(a(U),n=>(h(),y(p,{key:n.action,label:n.action},{default:l(()=>[D($(n.name),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),ue(_("div",Fe,[_("pre",{innerHTML:a(V)},null,8,Pe)],512),[[ce,a(V)]])]),_:1}),e(f,{label:"图标",prop:"icon"},{default:l(()=>[a(o).icon?(h(),y(Q,{key:0,class:"flex flex-center mr-4",style:{width:"30px",height:"30px"},size:"24px",color:"#000010"},{default:l(()=>[(h(),y(O(a(o).icon)))]),_:1})):z("",!0),e(ae,{placement:"top",width:600,trigger:"click"},{reference:l(()=>[e(T,{size:"small",type:"primary",icon:"Search"})]),default:l(()=>[_("div",Le,[(h(!0),x(B,null,j(a(F),n=>(h(),y(Q,{class:"flex flex-center pointer hover-bg rounded-2",style:{width:"50px",height:"50px"},size:"20px",color:"#000010",onClick:Ke=>a(o).icon=n},{default:l(()=>[(h(),y(O(n)))]),_:2},1032,["onClick"]))),256))])]),_:1})]),_:1}),e(f,{label:"权重",prop:"sort"},{default:l(()=>[e(se,{modelValue:a(o).sort,"onUpdate:modelValue":t[7]||(t[7]=n=>a(o).sort=n),min:0,max:99,step:1,"step-strictly":""},null,8,["modelValue"])]),_:1}),e(f,{label:"是否显示",prop:"is_show"},{default:l(()=>[e(W,{modelValue:a(o).is_show,"onUpdate:modelValue":t[8]||(t[8]=n=>a(o).is_show=n),"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue"])]),_:1}),e(f,{label:"状态",prop:"state"},{default:l(()=>[e(W,{modelValue:a(o).state,"onUpdate:modelValue":t[9]||(t[9]=n=>a(o).state=n),"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Ne={class:"bg-white rounded-4 p-4 flex-1 overflow-hidden flex flex-column"},He={class:"flex pb-4"},qe=_("div",{class:"flex-1"},null,-1),Oe={key:0},Ge={class:"flex"},Je={key:0,class:"w-15 min-w-15"},Qe={key:0},We=J({name:"/auth"}),ct=J({...We,setup(oe){const{setMenu:M}=we(),A=C([]),I=(i,c,u)=>{d.get("auth/index/Query",{params:{id:i.id}}).then(g=>{g.code===d.ResponseCode.SUCCESS&&u(g.data)}).catch(g=>{m.error(g.message)})},v=()=>{d.get("auth/index/Query").then(i=>{A.value=[],i.code===d.ResponseCode.SUCCESS&&(A.value=i.data)}).catch(i=>{m.error(i.message)})},k=()=>{const i=Ve.service();d.get("auth/index/Cache").then(c=>{i.close(),c&&(c.code===d.ResponseCode.SUCCESS?(M(c.data),m.success(c.message)):m.info(c.message))}).catch(c=>{i.close(),m.error(c.message)})},R=i=>{d.post("auth/index/Delete",{id:i.row.id}).then(c=>{c&&(c.code===d.ResponseCode.SUCCESS?(m.success(c.message),A.value=[],v()):m.info(c.message))}).catch(c=>{m.error(c.message)})},V=C(),F=()=>{V.value.open()},P=i=>{V.value.open(i.row)},N=i=>{const c=i.row.is_show?0:1;d.post("auth/index/SetShow",{id:i.row.id}).then(u=>{if(u.code===d.ResponseCode.SUCCESS)m.success(u.message);else throw new Error(u.message)}).catch(u=>{m.error(u.message),G(()=>{i.row.is_show=c})})},H=i=>{const c=i.row.state?0:1;d.post("auth/index/SetState",{id:i.row.id}).then(u=>{if(u.code===d.ResponseCode.SUCCESS)m.success(u.message);else throw new Error(u.message)}).catch(u=>{m.error(u.message),G(()=>{i.row.state=c})})},q=ke((i,c)=>{d.post("auth/index/SetSort",{id:c.row.id,sort:i}).then(u=>{if(u.code!==d.ResponseCode.SUCCESS)throw new Error(u.message)}).catch(u=>{m.error(u.message)})},300);return Ce(()=>{v()}),(i,c)=>{const u=ee,g=xe,w=Se,E=Z,r=le,t=te,S=ye,b=be,f=Me;return h(),x("div",Ne,[_("div",He,[e(g,{effect:"dark",content:"刷新缓存",placement:"bottom-end"},{default:l(()=>[e(u,{type:"warning",icon:"Refresh",onClick:k})]),_:1}),e(g,{effect:"dark",content:"创建权限",placement:"bottom-end"},{default:l(()=>[e(u,{type:"primary",icon:"Plus",onClick:F},{default:l(()=>[D("创建")]),_:1})]),_:1}),qe]),e(b,{data:a(A),style:{width:"100%",height:"100%"},"row-key":"id",border:"",lazy:"",load:I,"tree-props":{children:"children",hasChildren:"hasChildren"}},{default:l(()=>[e(w,{prop:"title",label:"名称",width:"200"}),e(w,{label:"图标",width:"60"},{default:l(s=>[s.row.icon?(h(),y(E,{key:0,class:"flex flex-center",size:20,color:"#000010"},{default:l(()=>[(h(),y(O(s.row.icon)))]),_:2},1024)):z("",!0)]),_:1}),e(w,{label:"规则","min-width":"500"},{default:l(s=>[_("div",null,[_("div",null,$(s.row.url),1),s.row.son_auth?(h(),x("div",Oe,[(h(!0),x(B,null,j(s.row.son_auth,p=>(h(),x("div",Ge,[(h(!0),x(B,null,j(a(U),L=>(h(),x(B,null,[p==L.action?(h(),x("div",Je,$(L.name)+"：",1)):z("",!0)],64))),256)),_("div",null,$(s.row.url)+"/"+$(p),1)]))),256))])):z("",!0)])]),_:1}),e(w,{label:"控制器/操作",width:"200"},{default:l(s=>[s.row.controller&&s.row.action?(h(),x("div",Qe,$(s.row.controller)+"/"+$(s.row.action),1)):z("",!0)]),_:1}),e(w,{label:"显示",width:"80"},{default:l(s=>[e(r,{modelValue:s.row.is_show,"onUpdate:modelValue":p=>s.row.is_show=p,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},onChange:p=>N(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(w,{label:"状态",width:"80"},{default:l(s=>[e(r,{modelValue:s.row.state,"onUpdate:modelValue":p=>s.row.state=p,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},onChange:p=>H(s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(w,{label:"权重",width:"146"},{default:l(s=>[e(t,{modelValue:s.row.sort,"onUpdate:modelValue":p=>s.row.sort=p,min:0,max:99,step:1,"step-strictly":"",size:"small",onChange:p=>a(q)(p,s)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(w,{fixed:"right",label:"#",width:"160"},{default:l(s=>[e(g,{effect:"dark",content:"编辑",placement:"left"},{default:l(()=>[e(u,{type:"primary",icon:"Edit",size:"small",onClick:p=>P(s)},null,8,["onClick"])]),_:2},1024),e(S,{icon:"Delete","icon-color":"var(--el-color-danger)",title:"确定继续删除该数据及子数据吗？",width:"200px","confirm-button-text":"继续删除","confirm-button-type":"danger",onConfirm:p=>R(s)},{reference:l(()=>[e(u,{type:"danger",icon:"Delete",size:"small"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),e(f,{ref_key:"createAuthRef",ref:V,onSuccess:v},null,512)])}}});export{ct as default};
