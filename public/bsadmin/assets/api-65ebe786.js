import{d as D,r as h,h as I,a as z,A as L,w as i,k as m,l as e,y,u as n,K as P,au as j,av as H,B as M,$ as p,q as d,D as A,s as N,v as G,a2 as T,E as J,z as q,G as K,o as O,c as Q,a1 as W,aj as X,Q as Y,t as R,ak as Z,al as ee,P as le}from"./index-3b328f2a.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                 */import{H as F,p as te}from"./php-b26c5332.js";/* empty css                      *//* empty css                  *//* empty css                        *//* empty css                   */const oe={class:"flex w-100"},ae=m("div",{class:"mx-1 text-grey"},"/",-1),ne=m("div",{class:"mx-1 text-grey"},"/",-1),se={class:"hljs w-100 p-3 line-height-1"},ie=["innerHTML"],re={class:"dialog-footer flex"},ue=m("div",{class:"flex-1"},null,-1),ce=D({__name:"create-client-api",emits:["success"],setup(B,{expose:_,emit:w}){F.registerLanguage("php",te);const C=h(),f=h(!1),g=h(""),E=I({name:[{required:!0,message:"请输入名称",trigger:"blur"}],app:[{required:!0,message:"请输入应用",trigger:"blur"}],controller:[{required:!0,message:"请输入控制器",trigger:"blur"}],action:[{required:!0,message:"请输入操作",trigger:"blur"}],url:[{required:!0,message:"请输入URL",trigger:"blur"}]}),t=h({id:null,name:"",app:"",controller:"",action:"",url:"",state:1,state_msg:"",is_login:0}),V=s=>{b(),t.value.id=null,s()},U=()=>{C.value.validate((s,a)=>{if(s){let c="client/api/Add";t.value.id&&(c="client/api/Edit"),p.post(c,t.value).then(u=>{u.code===p.ResponseCode.SUCCESS?(d.success(u.message),V(()=>{f.value=!1}),w("success")):d.info(u.message)}).catch(u=>{d.error(u.message)})}else d.warning("请完善表单")})},b=()=>{C.value&&(C.value.resetFields(),o())},o=()=>{if(t.value.app&&t.value.controller&&t.value.action&&t.value.url){const s=`    public function ${t.value.action}(){}
`;g.value=F.highlight(`<?php 
namespace app\\${t.value.app}\\controller;
/**
* 服务端需要实现以下类与方法
*/
class ${t.value.controller} 
{
${s}}`,{language:"php"}).value}else g.value=""};return _({open:s=>{f.value=!0,s&&A(()=>{t.value=Object.assign({},s)})}}),(s,a)=>{const c=N,u=G,x=T,k=J,S=q,$=K;return z(),L($,{modelValue:n(f),"onUpdate:modelValue":a[11]||(a[11]=l=>M(f)?f.value=l:null),title:n(t).id?"编辑规则":"创建规则",width:"50%","before-close":V,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"form-dialog"},{footer:i(()=>[m("span",re,[e(S,{onClick:a[8]||(a[8]=l=>{V(()=>{f.value=!1})})},{default:i(()=>[y("取消")]),_:1}),ue,e(S,{onClick:a[9]||(a[9]=l=>b())},{default:i(()=>[y("重置")]),_:1}),e(S,{type:"primary",onClick:a[10]||(a[10]=l=>U())},{default:i(()=>[y("提交")]),_:1})])]),default:i(()=>[e(k,{"label-position":"right","label-width":"200px",size:"large",ref_key:"apiForm",ref:C,class:"w-80",model:n(t),rules:n(E)},{default:i(()=>[e(u,{label:"名称",prop:"name"},{default:i(()=>[e(c,{modelValue:n(t).name,"onUpdate:modelValue":a[0]||(a[0]=l=>n(t).name=l),placeholder:"接口名称"},null,8,["modelValue"])]),_:1}),e(u,{label:"URL",prop:"url"},{default:i(()=>[e(c,{modelValue:n(t).url,"onUpdate:modelValue":a[1]||(a[1]=l=>n(t).url=l),placeholder:"服务端用作API，无需‘/’开头"},null,8,["modelValue"])]),_:1}),e(u,{label:"控制器/操作"},{default:i(()=>[m("div",oe,[e(u,{prop:"app"},{default:i(()=>[e(c,{modelValue:n(t).app,"onUpdate:modelValue":a[2]||(a[2]=l=>n(t).app=l),placeholder:"应用名",onInput:o},null,8,["modelValue"])]),_:1}),ae,e(u,{prop:"controller"},{default:i(()=>[e(c,{modelValue:n(t).controller,"onUpdate:modelValue":a[3]||(a[3]=l=>n(t).controller=l),placeholder:"控制器类名",onInput:o},null,8,["modelValue"])]),_:1}),ne,e(u,{prop:"action"},{default:i(()=>[e(c,{modelValue:n(t).action,"onUpdate:modelValue":a[4]||(a[4]=l=>n(t).action=l),placeholder:"操作名",onInput:o},null,8,["modelValue"])]),_:1})])]),_:1}),e(u,{label:"是否需要登录",prop:"is_login"},{default:i(()=>[e(x,{modelValue:n(t).is_login,"onUpdate:modelValue":a[5]||(a[5]=l=>n(t).is_login=l),"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue"])]),_:1}),e(u,{label:"状态",prop:"state"},{default:i(()=>[e(x,{modelValue:n(t).state,"onUpdate:modelValue":a[6]||(a[6]=l=>n(t).state=l),"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue"])]),_:1}),n(t).state?P("",!0):(z(),L(u,{key:0,label:"禁用提示",prop:"state_msg"},{default:i(()=>[e(c,{type:"textarea",modelValue:n(t).state_msg,"onUpdate:modelValue":a[7]||(a[7]=l=>n(t).state_msg=l),placeholder:"禁用提示"},null,8,["modelValue"])]),_:1})),e(u,{label:"代码预览",prop:"son_api"},{default:i(()=>[j(m("div",se,[m("pre",{innerHTML:n(g)},null,8,ie)],512),[[H,n(g)]])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),de={class:"bg-white rounded-4 p-4 flex-1 overflow-hidden flex flex-column"},pe={class:"flex pb-4"},me=m("div",{class:"flex-1"},null,-1),_e={class:"px-4 pt-4 xlcms-pagination"},ge=D({name:"/client/api"}),Ue=D({...ge,setup(B){const _=h({total:0,per_page:20,page:1}),w=h([]),C=o=>{_.value.per_page=o,_.value.page=1,g()},f=o=>{_.value.page=o,g()},g=()=>{p.get("client/api",{params:_.value}).then(o=>{w.value=[],o.code===p.ResponseCode.SUCCESS&&(_.value.total=o.data.total,_.value.per_page=o.data.per_page,w.value=o.data.data)}).catch(o=>{d.error(o.message)})},E=()=>{const o=Z.service();p.get("client/api/Cache").then(r=>{o.close(),r.code===p.ResponseCode.SUCCESS?d.success(r.message):d.info(r.message)}).catch(r=>{o.close(),d.error(r.message)})},t=o=>{const r=o.row.is_login?0:1;p.post("client/api/SetLogin",{id:o.row.id}).then(s=>{if(s.code===p.ResponseCode.SUCCESS)d.success(s.message);else throw new Error(s.message)}).catch(s=>{d.error(s.message),A(()=>{o.row.is_login=r})})},V=o=>{const r=o.row.state?0:1;p.post("client/api/SetState",{id:o.row.id}).then(s=>{if(s.code===p.ResponseCode.SUCCESS)d.success(s.message);else throw new Error(s.message)}).catch(s=>{d.error(s.message),A(()=>{o.row.state=r})})},U=o=>{p.post("client/api/Delete",{id:o.row.id}).then(r=>{r&&(r.code===p.ResponseCode.SUCCESS?(d.success(r.message),w.value=[],g()):d.info(r.message))}).catch(r=>{d.error(r.message)})},b=h();return O(()=>{g()}),(o,r)=>{const s=q,a=W,c=ee,u=T,x=le,k=X,S=Y,$=ce;return z(),Q("div",de,[m("div",pe,[e(a,{effect:"dark",content:"刷新缓存",placement:"bottom-end"},{default:i(()=>[e(s,{type:"warning",icon:"Refresh",onClick:E})]),_:1}),e(a,{effect:"dark",content:"创建接口",placement:"bottom-end"},{default:i(()=>[e(s,{type:"primary",icon:"Plus",onClick:r[0]||(r[0]=l=>n(b).open())},{default:i(()=>[y("创建")]),_:1})]),_:1}),me]),e(k,{data:n(w),style:{width:"100%",height:"100%"},border:""},{default:i(()=>[e(c,{prop:"name",label:"名称",width:"200"}),e(c,{prop:"url",label:"URL","min-width":"200"}),e(c,{label:"应用/控制器/操作",width:"300"},{default:i(l=>[m("div",null,R(l.row.app)+"/"+R(l.row.controller)+"/"+R(l.row.action),1)]),_:1}),e(c,{label:"登录",width:"80"},{default:i(l=>[e(u,{modelValue:l.row.is_login,"onUpdate:modelValue":v=>l.row.is_login=v,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},onChange:v=>t(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(c,{label:"状态",width:"80"},{default:i(l=>[e(u,{modelValue:l.row.state,"onUpdate:modelValue":v=>l.row.state=v,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},onChange:v=>V(l)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),e(c,{fixed:"right",label:"#",width:"160"},{default:i(l=>[e(a,{effect:"dark",content:"编辑",placement:"left"},{default:i(()=>[e(s,{type:"primary",icon:"Edit",size:"small",onClick:v=>n(b).open(l.row)},null,8,["onClick"])]),_:2},1024),e(x,{icon:"Delete","icon-color":"var(--el-color-danger)",title:"确定继续删除该数据及子数据吗？",width:"200px","confirm-button-text":"继续删除","confirm-button-type":"danger",onConfirm:v=>U(l)},{reference:i(()=>[e(s,{type:"danger",icon:"Delete",size:"small"})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),m("div",_e,[e(S,{"page-sizes":[10,20,50,100],background:"",layout:"total, sizes, prev, pager, next, jumper",total:n(_).total,"page-size":n(_).per_page,onSizeChange:C,onCurrentChange:f},null,8,["total","page-size"])]),e($,{ref_key:"createClientApiRef",ref:b,onSuccess:g},null,512)])}}});export{Ue as default};
