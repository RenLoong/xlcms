import{d as j,r as h,h as de,j as P,a as i,A as k,w as l,k as u,l as t,y as z,u as e,c as x,B as ae,$ as S,q as T,C as Ee,D as le,F as Q,_ as $e,v as Ue,s as Me,E as Ve,z as re,G as Re,H as q,I as G,J as Y,t as A,K as O,L as J,p as w,M as pe,N as Ie,O as Te,P as De,x as ze,Q as Ae,R as Le,S as ne,T as Ne,U as Pe,g as _e,e as Be,V as Fe,W as fe,X as Oe,Y as me,b as je,Z as He,o as Ke,i as We,n as qe,a0 as ue,a1 as Je,a2 as Ge,a3 as Ye,a4 as Qe,m as Xe,a5 as Ze,a6 as et,a7 as tt}from"./index-3b328f2a.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css                 *//* empty css                      *//* empty css               *//* empty css                  *//* empty css                 *//* empty css                   */import{_ as ve}from"./_plugin-vue_export-helper-c27b6911.js";const ot=["src"],lt={class:"dialog-footer flex"},nt=u("div",{class:"flex-1"},null,-1),st=j({__name:"edit-admin-self",emits:["success"],setup(U,{expose:$,emit:E}){const y=h(),a=de({nickname:[{required:!0,message:"请输入管理员昵称",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}]}),g=h(!1),d=h({nickname:"",avatar:"",avatar_url:"",username:"",password:"",mobile:"",email:""}),M=f=>{V(),d.value.avatar_url="",f()},p=()=>{y.value.validate((f,_)=>{f?S.post("admin/editSelf",d.value).then(b=>{b.code===S.ResponseCode.SUCCESS?(T.success(b.message),Ee(),M(()=>{g.value=!1}),E("success")):T.info(b.message)}).catch(b=>{T.error(b.message)}):T.warning("请完善表单")})},V=()=>{y.value&&y.value.resetFields()},C=f=>{if(["image/jpeg","image/png","image/jpg"].includes(f.type)){if(f.size/1024/1024>2)return T.error("请选择2MB以内的图片!"),!1}else return T.error("请选择图片"),!1;return!0},m=f=>{if(f.code===S.ResponseCode.SUCCESS){const _=f.data;_.action==="admin/avatar"&&(d.value.avatar=_.path,d.value.avatar_url=_.url)}else T.error(f.message)};return $({open:f=>{g.value=!0,f&&le(()=>{d.value=Object.assign({password:""},f)})}}),(f,_)=>{const b=P("Avatar"),D=Q,o=$e,s=Ue,R=Me,B=Ve,I=re,r=Re;return i(),k(r,{modelValue:e(g),"onUpdate:modelValue":_[7]||(_[7]=c=>ae(g)?g.value=c:null),title:"账户信息",width:"50%","before-close":M,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"form-dialog"},{footer:l(()=>[u("span",lt,[t(I,{onClick:_[5]||(_[5]=c=>{M(()=>{g.value=!1})})},{default:l(()=>[z("取消")]),_:1}),nt,t(I,{type:"primary",onClick:_[6]||(_[6]=c=>p())},{default:l(()=>[z("提交")]),_:1})])]),default:l(()=>[t(B,{"label-position":"right","label-width":"200px",size:"large",ref_key:"adminForm",ref:y,class:"w-80",model:e(d),rules:e(a)},{default:l(()=>[t(s,{prop:"avatar"},{default:l(()=>[t(o,{accept:"image/jpeg,image/png,image/jpg",data:{action:"admin/avatar"},"show-file-list":!1,"on-success":m,"before-upload":C,class:"mx-auto mb-10"},{default:l(()=>[e(d).avatar_url?(i(),x("img",{key:0,src:e(d).avatar_url,class:"rounded-circle",height:"200",width:"200"},null,8,ot)):(i(),k(D,{key:1,class:"bg-hover rounded-circle flex flex-center",style:{height:"200px",width:"200px"},size:"84px",color:"#999999"},{default:l(()=>[t(b)]),_:1}))]),_:1})]),_:1}),t(s,{label:"昵称",prop:"nickname"},{default:l(()=>[t(R,{modelValue:e(d).nickname,"onUpdate:modelValue":_[0]||(_[0]=c=>e(d).nickname=c),placeholder:"管理员昵称"},null,8,["modelValue"])]),_:1}),t(s,{label:"用户名",prop:"username"},{default:l(()=>[t(R,{modelValue:e(d).username,"onUpdate:modelValue":_[1]||(_[1]=c=>e(d).username=c),placeholder:"管理员登录账号"},null,8,["modelValue"])]),_:1}),t(s,{label:"密码",prop:"password"},{default:l(()=>[t(R,{modelValue:e(d).password,"onUpdate:modelValue":_[2]||(_[2]=c=>e(d).password=c),placeholder:"不填则不修改密码"},null,8,["modelValue"])]),_:1}),t(s,{label:"手机号",prop:"mobile"},{default:l(()=>[t(R,{modelValue:e(d).mobile,"onUpdate:modelValue":_[3]||(_[3]=c=>e(d).mobile=c),placeholder:"联系手机号"},null,8,["modelValue"])]),_:1}),t(s,{label:"邮箱",prop:"email"},{default:l(()=>[t(R,{modelValue:e(d).email,"onUpdate:modelValue":_[4]||(_[4]=c=>e(d).email=c),placeholder:"联系邮箱"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}}});const at={class:"flex font-weight-600"},rt={key:0},ct={key:0,class:"mb-4 bg rounded-4 p-4"},it={class:"flex flex-center mb-4"},ut={class:"flex-1 pl-2 h10"},dt={class:"font-weight-600 h9 mb-2"},pt={class:"text-grey"},_t={key:0,class:"flex flex-center mt-4"},ft=["onClick"],mt=["onClick"],vt={key:1,class:"flex flex-center h-100"},ht={class:"text-initial"},gt=j({__name:"message-list",setup(U,{expose:$}){const E=h(!1),y=o=>{o()},a=h({page:1,limit:20,total:0,state:"all"}),g=(o,s)=>{a.value[o]=s,a.value.page=1,C()},d=o=>{a.value.page=1,a.value.limit=o,C()},M=o=>{a.value.page=o,C()},p=h([]),V=h(!1),C=()=>{V.value||(V.value=!0,S.get("Message/index",{params:a.value}).then(o=>{V.value=!1,p.value=[],o.code===S.ResponseCode.SUCCESS&&(a.value.total=o.data.total,a.value.limit=o.data.per_page,p.value=o.data.data)}).catch(()=>{V.value=!1}))},m=()=>{E.value=!0,a.value.page=1,a.value.state=0,C()},L=()=>{E.value=!1},f=o=>{o&&o.is_read||S.post("Message/read",{id:o==null?void 0:o.id}).then(s=>{s.code===S.ResponseCode.SUCCESS?(o?(o.is_read=1,o.effect="info"):C(),J.emit("message")):T.info(s.msg)})},_=o=>{S.post("DevTeam/rejectTeamInvite",{id:o.alias_id}).then(s=>{s.code===S.ResponseCode.SUCCESS?(o.is_read=1,o.invite_state=2,J.emit("message")):T.info(s.msg)})},b=o=>{S.post("DevTeam/acceptTeamInvite",{id:o.alias_id}).then(s=>{s.code===S.ResponseCode.SUCCESS?(o.is_read=1,o.invite_state=1,J.emit("message")):T.info(s.msg)})},D=o=>{o.is_read||f(o),o.extra&&(o.extra.identity==="dev"?w.push("/control/developer/issues"):w.push("/issues/detail?id="+o.alias_id),L())};return $({open:m,close:L}),(o,s)=>{const R=P("Delete"),B=Q,I=re,r=pe,c=Ie,N=Te,X=De,Z=ze,H=Ae,ee=Le;return i(),k(ee,{modelValue:e(E),"onUpdate:modelValue":s[6]||(s[6]=n=>ae(E)?E.value=n:null),"before-close":y,size:"500px","show-close":!1},{header:l(()=>[u("div",at,[u("div",{class:q(["header-item",{"header-item--active":e(a).state==="all"}]),onClick:s[0]||(s[0]=n=>g("state","all"))},"全部",2),u("div",{class:q(["header-item",{"header-item--active":e(a).state===0}]),onClick:s[1]||(s[1]=n=>g("state",0))},"未读",2),u("div",{class:q(["header-item",{"header-item--active":e(a).state===1}]),onClick:s[2]||(s[2]=n=>g("state",1))},"历史",2)]),t(I,{type:"info",onClick:s[3]||(s[3]=n=>f()),link:""},{default:l(()=>[t(B,{class:"el-icon--left"},{default:l(()=>[t(R)]),_:1}),z(" 全部已读 ")]),_:1})]),footer:l(()=>[u("div",ht,[t(H,{"current-page":e(a).page,"onUpdate:currentPage":s[4]||(s[4]=n=>e(a).page=n),"page-size":e(a).limit,"onUpdate:pageSize":s[5]||(s[5]=n=>e(a).limit=n),"page-sizes":[10,20,50,100],background:"",layout:"sizes, prev, pager, next",total:e(a).total,"pager-count":5,onSizeChange:d,onCurrentChange:M},null,8,["current-page","page-size","total"])])]),default:l(()=>[e(p).length>0?(i(),x("div",rt,[(i(!0),x(G,null,Y(e(p),n=>(i(),x("div",null,[n.type==="inviteJoinTeam"?(i(),x("div",ct,[u("div",it,[t(r,{src:n.extra.headimg,size:60},null,8,["src"]),u("div",ut,[u("div",dt,A(n.extra.title)+"团队",1),u("div",pt,A(n.extra.email),1)]),t(c,{href:n.extra.home_url,target:"_blank",underline:!1},{default:l(()=>[z("Ta的主页")]),_:2},1032,["href"])]),t(N,{title:"邀请函",type:n.invite_state===0?"info":n.invite_state===1?"success":"error",description:n.title,"show-icon":"",closable:!1},null,8,["type","description"]),n.invite_state===0?(i(),x("div",_t,[t(X,{title:"确认拒绝"+n.extra.title+"团队的邀请吗？",width:"200px",onConfirm:K=>_(n)},{reference:l(()=>[t(I,{type:"danger"},{default:l(()=>[z("拒绝")]),_:1})]),_:2},1032,["title","onConfirm"]),t(I,{type:"success",onClick:K=>b(n)},{default:l(()=>[z("接受")]),_:2},1032,["onClick"])])):O("",!0)])):O("",!0),n.type==="issues"?(i(),x("div",{key:1,class:"mb-4 pointer",onClick:K=>D(n)},[t(N,{title:n.type_text,type:n.effect,description:n.title,closable:!1,"show-icon":""},null,8,["title","type","description"])],8,ft)):(i(),x("div",{key:2,class:q(["mb-4",{pointer:n.is_read===0}]),onClick:K=>f(n)},[t(N,{title:n.type_text,type:n.effect,description:n.title,closable:!1,"show-icon":""},null,8,["title","type","description"])],10,mt))]))),256))])):(i(),x("div",vt,[t(Z,{description:"暂无消息~"})]))]),_:1},8,["modelValue"])}}});const xt=ve(gt,[["__scopeId","data-v-3e2ff86f"]]);const kt=j({__name:"xlcms-el-menu-item",props:{auth:{default:[]},level:{default:1}},setup(U){const $=U;return(E,y)=>{const a=Q,g=P("xlcms-el-menu-item",!0),d=Ne,M=Pe;return i(!0),x(G,null,Y($.auth,p=>(i(),x(G,null,[p.children&&p.children.length?(i(),k(d,{key:0,index:p.path},{title:l(()=>[p.icon?(i(),k(a,{key:0},{default:l(()=>[(i(),k(ne(p.icon)))]),_:2},1024)):O("",!0),u("span",null,A(p.title),1)]),default:l(()=>[t(g,{auth:p.children,level:U.level+1},null,8,["auth","level"])]),_:2},1032,["index"])):(i(),k(M,{key:1,index:p.path},{title:l(()=>[z(A(p.title),1)]),default:l(()=>[p.icon?(i(),k(a,{key:0},{default:l(()=>[(i(),k(ne(p.icon)))]),_:2},1024)):O("",!0)]),_:2},1032,["index"]))],64))),256)}}}),yt=j({__name:"item-control-menu",props:{count:{default:0},dev_issues:{default:0},issues:{default:0}},setup(U){const{MENU:$}=_e(Be());return(E,y)=>{const a=kt,g=Fe;return i(),k(g,{router:""},{default:l(()=>[t(a,{auth:e($)},null,8,["auth"])]),_:1})}}});const ce="THEME",ie=me(),F=h(ie.get(ce)||"OS"),se=matchMedia("(prefers-color-scheme: dark)"),oe=()=>{se.matches?document.documentElement.dataset.theme="dark":document.documentElement.dataset.theme="light"};fe(()=>{ie.set(ce,F.value),F.value==="OS"?(se.addEventListener("change",oe),oe()):(document.documentElement.dataset.theme=F.value,se.removeEventListener("change",oe))});Oe(ie.getKey(ce),U=>{if(!U)F.value="OS";else if(U.newValue!==null){const $=JSON.parse(U.newValue).data;F.value=$}});function Ct(){return{theme:F}}const bt={class:"page vw-100 vh-100"},wt={class:"control-left flex flex-column"},St={class:"p-6 flex flex-center"},Et={key:0,class:"py-6 text-center h10 text-grey"},$t={class:"flex-1 flex flex-column p-4"},Ut={class:"coltrol-header mb-4"},Mt=["onClick"],Vt={class:"h9 font-weight-600 text-keep-all"},Rt={class:"flex coltrol-header-tool px-4 ml-10"},It={class:"px-4 flex flex-center"},Tt={class:"hover-bg-hover rounded-4"},Dt={class:"h9 font-weight-600 pr-3 text-right text-ellipsis-1",style:{"max-width":"200px"}},zt=j({name:"/Main"}),At=j({...zt,setup(U){const $=me(),E=je(),{USERINFO:y}=_e(E),a=h([]),g=h([]),d=h();a.value.push({key:"username",title:"账户:"+y.value.username,props:{class:"flex-x-center",disabled:!0,divided:!!g.value.length}}),a.value.push({key:"userinfo",title:"账户管理",props:{class:"flex-x-center"},handle:()=>{d.value.open(y.value)}}),a.value.push({key:"outlogin",title:"退出登录",props:{class:"flex-x-center"},handle:()=>{E.clearUserInfo().then(()=>{w.currentRoute.value.meta.login!==!1&&($.set("login_redirect_url",w.currentRoute.value.fullPath),w.push("/login"))})}});const M=r=>{typeof r.handle=="function"&&r.handle()},p=h(!1),V=h("/control"),C=h(),m=de([]);fe(()=>{const r=w.currentRoute.value;V.value=r.path,le(()=>{r.meta.showHeader&&m.find(c=>c.path==r.path)===void 0&&(m.push(r),le(()=>{C.value.scrollTo({left:C.value.scrollWidth+200,behavior:"smooth"})}))})});const L=h(),f=r=>{if(m[r].meta.componentName?L.value=m[r].meta.componentName:L.value=m[r].path,w.currentRoute.value.name!==m[r].name)return m.splice(r,1);m[r+1]?(w.push(m[r+1].fullPath),m.splice(r,1)):m[r-1]&&(w.push(m[r-1].fullPath),m.splice(r,1))},_=(r,c)=>{w.push(c.fullPath);const N=r.target.offsetLeft+r.target.offsetWidth/2-C.value.offsetWidth/2-12;C.value.scrollTo({left:N,behavior:"smooth"})};He(()=>{V.value=w.currentRoute.value.path});const b=h(!1),D=h({count:0,dev_issues:0,issues:0}),o=()=>{b.value||(b.value=!0,S.get("Message/getUnreadCount").then(r=>{r&&r.code===S.ResponseCode.SUCCESS&&(D.value=r.data)}).finally(()=>{b.value=!1}))};let s;const R=h(),B=h(),{theme:I}=Ct();return Ke(()=>{o(),J.on("message",o)}),We(()=>{clearInterval(s),J.remove("message",o)}),(r,c)=>{const N=re,X=yt,Z=P("Close"),H=Q,ee=P("Monitor"),n=Je,K=P("Notification"),he=Ge,ge=pe,xe=et,ke=tt,ye=Ye,Ce=P("router-view"),be=xt,we=st;return i(),x("main",bt,[u("div",wt,[u("div",St,[t(N,{type:"primary",icon:e(p)?"Expand":"Fold",onClick:c[0]||(c[0]=v=>p.value=!e(p)),link:""},null,8,["icon"])]),u("div",{class:"flex-1 overflow-y-auto control-left-menu-body",style:qe({width:e(p)?"auto":"200px"})},[t(X,ue(e(D),{"default-active":e(V),class:"control-left-menu",collapse:e(p)}),null,16,["default-active","collapse"])],4),e(p)?O("",!0):(i(),x("div",Et,"v"+A(e(Qe).version_name),1))]),u("div",$t,[u("header",Ut,[u("div",{class:"flex-1 flex flex-y-center flex-nowrap overflow-x-auto coltrol-header-tabs",ref_key:"coltrolHeaderTabsRef",ref:C},[(i(!0),x(G,null,Y(e(m),(v,W)=>(i(),x("div",{class:"text-grey",key:W},[u("div",{class:q(["rounded-4 px-4 py-2 pointer flex flex-center mr-1 coltrol-header-tabs-item",{"bg-white text-dark":e(w).currentRoute.value.path==v.path}]),onClick:te=>_(te,v)},[u("span",Vt,A(v.meta.title),1),v.path!=="/index"&&e(m).length>1?(i(),k(H,{key:0,class:"ml-2 coltrol-header-tabs-close-icon",onClick:Xe(te=>f(W),["stop"]),color:"#999999"},{default:l(()=>[t(Z,{class:"text-dark"})]),_:2},1032,["onClick"])):O("",!0)],10,Mt)]))),128))],512),u("div",Rt,[t(n,{content:"打开首页",placement:"bottom-end"},{default:l(()=>[u("div",{class:"px-4 pointer hover-bg-hover rounded-4 flex flex-center",onClick:c[1]||(c[1]=v=>e(w).push("/"))},[t(H,null,{default:l(()=>[t(ee,{class:"text-dark"})]),_:1})])]),_:1}),t(n,{disabled:e(D).count>0,content:"查看通知",placement:"bottom-end"},{default:l(()=>[u("div",{class:"px-4 pointer hover-bg-hover rounded-4 flex flex-center",ref_key:"notificationIconRef",ref:R,onClick:c[2]||(c[2]=v=>e(B).open())},[t(H,null,{default:l(()=>[t(K,{class:"text-dark"})]),_:1})],512)]),_:1},8,["disabled"]),u("div",It,[t(he,{modelValue:e(I),"onUpdate:modelValue":c[3]||(c[3]=v=>ae(I)?I.value=v:null),style:{"--el-switch-on-color":"#2c2c2c"},"active-action-icon":"Moon","inactive-action-icon":"Sunny","active-value":"dark","inactive-value":"OS"},null,8,["modelValue"])]),t(n,{visible:e(D).count>0,content:"有新消息",placement:"bottom",effect:"red","virtual-triggering":"","virtual-ref":e(R)},null,8,["visible","virtual-ref"]),u("div",Tt,[t(ye,{"hide-on-click":!1,onCommand:M,teleported:!1,placement:"bottom-end"},{dropdown:l(()=>[t(ke,null,{default:l(()=>[(i(!0),x(G,null,Y(e(a),v=>(i(),k(xe,ue({key:v.key,command:v},v.props),{default:l(()=>[z(A(v.title),1)]),_:2},1040,["command"]))),128))]),_:1})]),default:l(()=>{var v,W;return[u("div",{class:"flex flex-center p-2 pointer",onClick:c[4]||(c[4]=te=>M(e(a).find(Se=>Se.key==="userinfo")))},[u("div",Dt,A((v=e(y))==null?void 0:v.nickname),1),t(ge,{size:30,src:(W=e(y))==null?void 0:W.avatar_url},null,8,["src"])])]}),_:1})])])]),t(Ce,null,{default:l(({Component:v})=>[(i(),k(Ze,{exclude:e(L)},[(i(),k(ne(v)))],1032,["exclude"]))]),_:1}),t(be,{ref_key:"messageListRef",ref:B},null,512),t(we,{ref_key:"editAdminSelfRef",ref:d},null,512)])])}}});const Jt=ve(At,[["__scopeId","data-v-eafce6c0"]]);export{Jt as default};
