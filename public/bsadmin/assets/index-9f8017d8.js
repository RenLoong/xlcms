import{d as G,r as h,h as ie,j as de,a as f,A as S,w as o,k as r,l as e,y as b,u as a,K as B,c as R,B as K,I as L,J as O,aA as j,t as p,$ as v,q as c,D as W,ae as re,v as ue,F as me,_ as ce,s as _e,aB as pe,aw as fe,ax as ge,a2 as X,E as ve,z as Y,G as we,o as he,a1 as be,aj as ke,Q as Ce,al as xe,ad as ye,an as Ve,P as Se}from"./index-3b328f2a.js";/* empty css                   *//* empty css                  *//* empty css                     *//* empty css               *//* empty css                          *//* empty css                        *//* empty css                 *//* empty css                  */import{_ as Ee}from"./xlcms-el-option.vue_vue_type_script_setup_true_lang-ce304949.js";/* empty css                      *//* empty css                   */const $e=["src"],Ue={class:"w-100 flex"},ze={key:0,class:"text-grey ml-3"},Ae={class:"w-100"},De={class:"dialog-footer flex"},Re=r("div",{class:"flex-1"},null,-1),Me=G({__name:"create-admin",emits:["success"],setup(Z,{expose:k,emit:E}){const $=h(),M=ie({admin_role_id:[{required:!0,message:"请选择角色",trigger:"change"}],nickname:[{required:!0,message:"请输入管理员昵称",trigger:"blur"}],username:[{required:!0,message:"请输入用户名",trigger:"blur"}],time:[{required:!0,message:"请设置工作时间",trigger:"change"}]});let C=new Date;C.setHours(0),C.setMinutes(0),C.setSeconds(0);let U=new Date;U.setHours(23),U.setMinutes(59),U.setSeconds(59);const F=h([C,U]),w=h(!1),d=h(!1),m=h(!0),_=h([]),l=h({id:void 0,admin_role_id:void 0,nickname:"",avatar:"",avatar_url:"",username:"",password:"",mobile:"",email:"",is_system:0,state:1,time:F.value,allow_time_start:"08:00:00",allow_time_end:"18:00:00",allow_week:[1,2,3,4,5]}),g=()=>{v.get("role/index").then(s=>{s.code===v.ResponseCode.SUCCESS&&(_.value=s.data)}).catch(s=>{c.error(s.message)})},A=s=>{T(),l.value.id=void 0,l.value.admin_role_id=void 0,l.value.avatar_url="",l.value.is_system=0,s()},z=()=>{const s=l.value.time[0],t=l.value.time[1];l.value.allow_time_start=`${s.getHours()}:${s.getMinutes()}:${s.getSeconds()}`,l.value.allow_time_end=`${t.getHours()}:${t.getMinutes()}:${t.getSeconds()}`,$.value.validate((x,y)=>{if(x){let u="admin/index/Add";l.value.id&&(u="admin/index/Edit"),v.post(u,l.value).then(V=>{V.code===v.ResponseCode.SUCCESS?(c.success(V.message),A(()=>{w.value=!1}),E("success")):c.info(V.message)}).catch(V=>{c.error(V.message)})}else c.warning("请完善表单")})},T=()=>{$.value&&$.value.resetFields()},I=s=>{s?l.value.allow_week=[...Array(7)].map((t,x)=>x):l.value.allow_week=[],m.value=!1},H=s=>{const t=s.length;d.value=t===j.length,m.value=t>0&&t<j.length},P=s=>{if(["image/jpeg","image/png","image/jpg"].includes(s.type)){if(s.size/1024/1024>2)return c.error("请选择2MB以内的图片!"),!1}else return c.error("请选择图片"),!1;return!0},q=s=>{if(s.code===v.ResponseCode.SUCCESS){const t=s.data;t.action==="admin/avatar"&&(l.value.avatar=t.path,l.value.avatar_url=t.url)}else c.error(s.message)};return k({open:s=>{if(g(),w.value=!0,s){const t=s.allow_time_start.split(":"),x=s.allow_time_end.split(":");let y=new Date;y.setHours(t[0]),y.setMinutes(t[1]),y.setSeconds(t[2]);let u=new Date;u.setHours(x[0]),u.setMinutes(x[1]),u.setSeconds(x[2]),W(()=>{l.value=Object.assign({password:"",time:[y,u]},s)})}}}),(s,t)=>{const x=Ee,y=re,u=ue,V=de("Avatar"),ee=me,le=ce,D=_e,te=pe,Q=fe,ae=ge,oe=X,se=ve,N=Y,ne=we;return f(),S(ne,{modelValue:a(w),"onUpdate:modelValue":t[13]||(t[13]=i=>K(w)?w.value=i:null),title:a(l).id?"编辑管理员":"创建管理员",width:"50%","before-close":A,draggable:"","close-on-click-modal":!1,"close-on-press-escape":!1,class:"form-dialog"},{footer:o(()=>[r("span",De,[e(N,{onClick:t[10]||(t[10]=i=>{A(()=>{w.value=!1})})},{default:o(()=>[b("取消")]),_:1}),Re,e(N,{onClick:t[11]||(t[11]=i=>T())},{default:o(()=>[b("重置")]),_:1}),e(N,{type:"primary",onClick:t[12]||(t[12]=i=>z())},{default:o(()=>[b("提交")]),_:1})])]),default:o(()=>[e(se,{"label-position":"right","label-width":"200px",size:"large",ref_key:"adminForm",ref:$,class:"w-80",model:a(l),rules:a(M)},{default:o(()=>[a(l).is_system?B("",!0):(f(),S(u,{key:0,label:"角色",prop:"admin_role_id"},{default:o(()=>[e(y,{modelValue:a(l).admin_role_id,"onUpdate:modelValue":t[0]||(t[0]=i=>a(l).admin_role_id=i),placeholder:"选择管理员所在的角色",class:"flex-1"},{default:o(()=>[e(x,{list:a(_),showicon:!1},null,8,["list"])]),_:1},8,["modelValue"])]),_:1})),e(u,{label:"头像",prop:"avatar"},{default:o(()=>[e(le,{accept:"image/jpeg,image/png,image/jpg",data:{action:"admin/avatar"},"show-file-list":!1,"on-success":q,"before-upload":P},{default:o(()=>[a(l).avatar_url?(f(),R("img",{key:0,src:a(l).avatar_url,class:"rounded-4",height:"100",width:"100"},null,8,$e)):(f(),S(ee,{key:1,class:"bg-hover rounded-circle flex flex-center",style:{height:"100px",width:"100px"},size:"42px",color:"#999999"},{default:o(()=>[e(V)]),_:1}))]),_:1})]),_:1}),e(u,{label:"昵称",prop:"nickname"},{default:o(()=>[e(D,{modelValue:a(l).nickname,"onUpdate:modelValue":t[1]||(t[1]=i=>a(l).nickname=i),placeholder:"管理员昵称"},null,8,["modelValue"])]),_:1}),e(u,{label:"用户名",prop:"username"},{default:o(()=>[e(D,{modelValue:a(l).username,"onUpdate:modelValue":t[2]||(t[2]=i=>a(l).username=i),placeholder:"管理员登录账号"},null,8,["modelValue"])]),_:1}),e(u,{label:"密码",prop:"password"},{default:o(()=>[e(D,{modelValue:a(l).password,"onUpdate:modelValue":t[3]||(t[3]=i=>a(l).password=i),placeholder:"管理员密码"},null,8,["modelValue"])]),_:1}),e(u,{label:"手机号",prop:"mobile"},{default:o(()=>[e(D,{modelValue:a(l).mobile,"onUpdate:modelValue":t[4]||(t[4]=i=>a(l).mobile=i),placeholder:"联系手机号"},null,8,["modelValue"])]),_:1}),e(u,{label:"邮箱",prop:"email"},{default:o(()=>[e(D,{modelValue:a(l).email,"onUpdate:modelValue":t[5]||(t[5]=i=>a(l).email=i),placeholder:"联系邮箱"},null,8,["modelValue"])]),_:1}),e(u,{label:"工作时间",prop:"time"},{default:o(()=>[e(te,{modelValue:a(l).time,"onUpdate:modelValue":t[6]||(t[6]=i=>a(l).time=i),"is-range":"","range-separator":"-","start-placeholder":"上班时间","end-placeholder":"下班时间",disabled:!!a(l).is_system},null,8,["modelValue","disabled"])]),_:1}),e(u,{label:"工作周",prop:"allow_week"},{default:o(()=>[r("div",Ue,[e(Q,{disabled:!!a(l).is_system,modelValue:a(d),"onUpdate:modelValue":t[7]||(t[7]=i=>K(d)?d.value=i:null),indeterminate:a(m),onChange:I},{default:o(()=>[b("全选")]),_:1},8,["disabled","modelValue","indeterminate"]),a(l).allow_week.length>=7?(f(),R("div",ze,"感谢你的付出。")):B("",!0)]),r("div",Ae,[e(ae,{disabled:!!a(l).is_system,modelValue:a(l).allow_week,"onUpdate:modelValue":t[8]||(t[8]=i=>a(l).allow_week=i),onChange:H},{default:o(()=>[(f(!0),R(L,null,O(a(j),(i,J)=>(f(),S(Q,{key:J,label:J},{default:o(()=>[b(p(i),1)]),_:2},1032,["label"]))),128))]),_:1},8,["disabled","modelValue"])])]),_:1}),e(u,{label:"状态",prop:"state"},{default:o(()=>[e(oe,{modelValue:a(l).state,"onUpdate:modelValue":t[9]||(t[9]=i=>a(l).state=i),disabled:!!a(l).is_system,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"}},null,8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}}}),Te={class:"bg-white rounded-4 p-4 flex-1 overflow-hidden flex flex-column"},je={class:"flex pb-4"},Be=r("div",{class:"flex-1"},null,-1),Fe={class:"font-weight-600"},Ie={class:"text-primary"},He={class:"font-weight-600"},Pe={class:"font-weight-600"},qe={class:"flex flex-y-center"},Ne=r("div",null,"~",-1),Ge={class:"h10"},Qe={class:"px-4 pt-4"},Je=G({name:"/admin"}),sl=G({...Je,setup(Z){const k=h({total:0,per_page:10,page:1}),E=h([]),$=d=>{k.value.per_page=d,C()},M=d=>{E.value=[],k.value.page=d,C()},C=()=>{v.get("admin/index/Query",{params:k.value}).then(d=>{E.value=[],d.code===v.ResponseCode.SUCCESS&&(k.value.total=d.data.total,k.value.per_page=d.data.per_page,E.value=d.data.data)}).catch(d=>{c.error(d.message)})},U=d=>{const m=d.state;d.state_loading=!0,v.post("admin/index/SetState",{id:d.id}).then(_=>{if(d.state_loading=!1,_.code===v.ResponseCode.SUCCESS)c.success(_.message);else throw new Error(_.message)}).catch(_=>{d.state_loading=!1,c.error(_.message),W(()=>{d.state=m})})},F=d=>{v.post("admin/index/Delete",{id:d.row.id}).then(m=>{m&&(m.code===v.ResponseCode.SUCCESS?(c.success(m.message),M(1)):c.info(m.message))}).catch(m=>{c.error(m.message)})},w=h();return he(()=>{C()}),(d,m)=>{const _=Y,l=be,g=xe,A=ye,z=Ve,T=X,I=Se,H=ke,P=Ce,q=Me;return f(),R("div",Te,[r("div",je,[e(l,{effect:"dark",content:"创建管理员",placement:"bottom-end"},{default:o(()=>[e(_,{type:"primary",icon:"Plus",onClick:m[0]||(m[0]=n=>a(w).open())},{default:o(()=>[b("创建")]),_:1})]),_:1}),Be]),e(H,{data:a(E),style:{width:"100%",height:"100%"},border:""},{default:o(()=>[e(g,{prop:"id",label:"ID",width:"100"}),e(g,{label:"头像",width:"100"},{default:o(n=>[n.row.avatar_url?(f(),S(A,{key:0,style:{width:"40px",height:"40px"},class:"rounded-4",src:n.row.avatar_url,"zoom-rate":1.2,"preview-teleported":"","preview-src-list":[n.row.avatar_url],fit:"cover"},null,8,["src","zoom-rate","preview-src-list"])):B("",!0)]),_:1}),e(g,{label:"管理员",width:"200"},{default:o(n=>[r("div",null,[r("div",Fe,p(n.row.nickname),1),r("div",Ie,p(n.row.username),1)])]),_:1}),e(g,{label:"角色",width:"200"},{default:o(n=>[e(z,null,{default:o(()=>[b(p(n.row.role_name),1)]),_:2},1024)]),_:1}),e(g,{label:"联系方式","min-width":"240"},{default:o(n=>[r("div",null,[r("div",He,p(n.row.mobile),1),r("div",Pe,p(n.row.email),1)])]),_:1}),e(g,{label:"工作时间","min-width":"260"},{default:o(n=>[r("div",null,[(f(!0),R(L,null,O(n.row.allow_week,s=>(f(),S(z,{size:"small",type:"success"},{default:o(()=>[b(p(a(j)[s]),1)]),_:2},1024))),256)),r("div",qe,[e(z,{size:"small",type:"info"},{default:o(()=>[b(p(n.row.allow_time_start),1)]),_:2},1024),Ne,e(z,{size:"small",type:"info"},{default:o(()=>[b(p(n.row.allow_time_end),1)]),_:2},1024)])])]),_:1}),e(g,{label:"状态",width:"80"},{default:o(n=>[e(T,{modelValue:n.row.state,"onUpdate:modelValue":s=>n.row.state=s,"active-value":1,"inactive-value":0,style:{"--el-switch-on-color":"var(--el-color-success)"},loading:n.row.state_loading,onChange:s=>U(n.row)},null,8,["modelValue","onUpdate:modelValue","loading","onChange"])]),_:1}),e(g,{label:"创建/登录/在线时间",width:"200"},{default:o(n=>[r("div",Ge,[r("div",null,p(n.row.create_time),1),r("div",null,p(n.row.login_time),1),r("div",null,p(n.row.online_time),1)])]),_:1}),e(g,{fixed:"right",label:"#",width:"160"},{default:o(n=>[e(l,{effect:"dark",content:"编辑",placement:"left"},{default:o(()=>[e(_,{type:"primary",icon:"Edit",size:"small",onClick:s=>a(w).open(n.row)},null,8,["onClick"])]),_:2},1024),n.row.is_system?B("",!0):(f(),S(I,{key:0,icon:"Delete","icon-color":"var(--el-color-danger)",title:"不建议删除管理员，建议禁用管理员，删除可能会造成数据混乱，是否继续删除？",width:"200px","confirm-button-text":"继续删除","confirm-button-type":"danger",onConfirm:s=>F(n)},{reference:o(()=>[e(_,{type:"danger",icon:"Delete",size:"small"})]),_:2},1032,["onConfirm"]))]),_:1})]),_:1},8,["data"]),r("div",Qe,[e(P,{"page-sizes":[10,20,50,100],"page-size":a(k).per_page,background:"",layout:"total, sizes, prev, pager, next, jumper",total:a(k).total,onSizeChange:$,onCurrentChange:M},null,8,["page-size","total"])]),e(q,{ref_key:"createAdminRef",ref:w,onSuccess:C},null,512)])}}});export{sl as default};
